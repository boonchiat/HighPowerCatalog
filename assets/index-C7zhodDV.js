var n=Object.defineProperty,e=(e,t,i)=>((e,t,i)=>t in e?n(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);!function(){const n=document.createElement("link").relList;if(!(n&&n.supports&&n.supports("modulepreload"))){for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const t of n)if("childList"===t.type)for(const n of t.addedNodes)"LINK"===n.tagName&&"modulepreload"===n.rel&&e(n)}).observe(document,{childList:!0,subtree:!0})}function e(n){if(n.ep)return;n.ep=!0;const e=function(n){const e={};return n.integrity&&(e.integrity=n.integrity),n.referrerPolicy&&(e.referrerPolicy=n.referrerPolicy),"use-credentials"===n.crossOrigin?e.credentials="include":"anonymous"===n.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(n);fetch(n.href,e)}}();class t{constructor(n){e(this,"startX",0),e(this,"startY",0),e(this,"startTime",0),e(this,"minSwipeDistance",50),e(this,"maxSwipeTime",500),e(this,"onSwipeLeft",null),e(this,"onSwipeRight",null),e(this,"onDoubleTap",null),e(this,"onTap",null),e(this,"lastTapTime",0),e(this,"lastTapX",0),e(this,"lastTapY",0),e(this,"doubleTapThreshold",300),e(this,"doubleTapDistance",50),n.addEventListener("touchstart",this.handleTouchStart.bind(this),!1),n.addEventListener("touchend",this.handleTouchEnd.bind(this),!1),n.addEventListener("touchmove",this.handleTouchMove.bind(this),!1)}handleTouchStart(n){const e=n.touches[0];this.startX=e.clientX,this.startY=e.clientY,this.startTime=Date.now()}handleTouchMove(n){Math.abs(n.touches[0].clientX-this.startX)>10&&n.preventDefault()}handleTouchEnd(n){var e,t,i,s;const a=n.changedTouches[0].clientX,o=n.changedTouches[0].clientY,r=Date.now(),l=a-this.startX,d=o-this.startY,c=r-this.startTime;if(Math.abs(l)>this.minSwipeDistance&&Math.abs(d)<this.minSwipeDistance&&c<this.maxSwipeTime)return void(l>0?null==(e=this.onSwipeRight)||e.call(this):null==(t=this.onSwipeLeft)||t.call(this));const h=Date.now(),p=h-this.lastTapTime,m=Math.sqrt(Math.pow(a-this.lastTapX,2)+Math.pow(o-this.lastTapY,2));p<this.doubleTapThreshold&&m<this.doubleTapDistance?(null==(i=this.onDoubleTap)||i.call(this),this.lastTapTime=0):(null==(s=this.onTap)||s.call(this),this.lastTapTime=h,this.lastTapX=a,this.lastTapY=o)}}class i{constructor(){e(this,"state",{isOfflineReady:!1,isCaching:!1,cacheProgress:0}),e(this,"stateChangeCallbacks",[]),e(this,"baseUrl","/HighPowerCatalog/"),this.checkCacheStatus()}async checkCacheStatus(){if("serviceWorker"in navigator)try{await navigator.serviceWorker.ready;console.log("Service Worker ready for offline support")}catch(n){console.warn("Service Worker not available:",n)}}async cacheBook(n){if(!("serviceWorker"in navigator)||!navigator.serviceWorker.controller)throw new Error("Service Worker not available");return new Promise((e,t)=>{const i=new MessageChannel;navigator.serviceWorker.controller.postMessage({type:"CACHE_BOOK",bookId:n.id,pages:n.pages},[i.port2]),i.port1.onmessage=n=>{"CACHE_COMPLETE"===n.data.type?(n.data.success?(this.setState({isOfflineReady:!0,isCaching:!1,cacheProgress:100}),e()):t(new Error(n.data.error||"Caching failed")),i.port1.close()):"CACHE_PROGRESS"===n.data.type&&this.setState({isCaching:!0,cacheProgress:Math.round(n.data.cached/n.data.total*100)})},setTimeout(()=>{i.port1.close(),t(new Error("Caching timeout"))},3e5)})}async isBookCached(n){if(!("caches"in window))return!1;try{const e=await caches.open("flipbook-runtime-v1"),t=`${this.baseUrl}books/${n}/manifest.json`;return!!(await e.match(t))}catch(e){return console.error("Error checking cache:",e),!1}}async clearCache(){if("caches"in window)try{const n=await caches.keys();await Promise.all(n.map(n=>caches.delete(n))),this.setState({isOfflineReady:!1,isCaching:!1,cacheProgress:0})}catch(n){console.error("Error clearing cache:",n)}}setState(n){this.state={...this.state,...n},this.stateChangeCallbacks.forEach(n=>n(this.state))}onStateChange(n){this.stateChangeCallbacks.push(n)}getState(){return{...this.state}}}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/HighPowerCatalog/sw.js").then(n=>{console.log("Service Worker registered:",n)}).catch(n=>{console.warn("Service Worker registration failed:",n)})});const s=new class{constructor(n,t="/HighPowerCatalog/"){e(this,"container"),e(this,"manifest",null),e(this,"currentPageIndex",0),e(this,"gestureHandler",null),e(this,"cacheManager"),e(this,"isLoading",!1),e(this,"baseUrl"),e(this,"zoom",1),e(this,"panX",0),e(this,"panY",0),e(this,"isPanning",!1),e(this,"panStartX",0),e(this,"panStartY",0),e(this,"zoomAnimationId",null),e(this,"panAnimationId",null),e(this,"minZoom",1),e(this,"maxZoom",3),e(this,"loadedPages",new Map),e(this,"pageCache",new Map),e(this,"deferredPrompt",null);const s=document.getElementById(n);if(!s)throw new Error(`Container with id "${n}" not found`);this.container=s,this.baseUrl=t,this.cacheManager=new i,this.setupContainer()}setupContainer(){this.container.innerHTML='\n      <div class="flipbook-viewer">\n        <div class="flipbook-header">\n          <button class="btn-menu" id="btnMenu" title="Menu">‚ò∞</button>\n          <h1 class="flipbook-title" id="bookTitle">Loading...</h1>\n          <button class="btn-download" id="btnDownload" title="Download for Offline">‚¨á</button>\n        </div>\n        \n        <div class="flipbook-content" id="flipbookContent">\n          <div class="zoom-controls">\n            <button class="btn-zoom" id="btnZoomOut" title="Zoom Out">‚àí</button>\n            <span class="zoom-level" id="zoomLevel">100%</span>\n            <button class="btn-zoom" id="btnZoomIn" title="Zoom In">+</button>\n            <button class="btn-zoom" id="btnFitWidth" title="Fit to Width">‚ä°</button>\n          </div>\n          \n          <div class="page-container" id="pageContainer">\n            <div class="page-viewer" id="pageViewer">\n              <img class="page-image" id="pageImage" alt="Book page" />\n            </div>\n          </div>\n          \n          <div class="page-controls">\n            <button class="btn-prev" id="btnPrev">‚Üê Previous</button>\n            <span class="page-counter" id="pageCounter">Page 1 of 1</span>\n            <button class="btn-next" id="btnNext">Next ‚Üí</button>\n          </div>\n        </div>\n\n        <div class="flipbook-sidebar" id="sidebar">\n          <div class="sidebar-header">\n            <h2>Thumbnails</h2>\n            <button class="btn-close-sidebar" id="btnCloseSidebar">‚úï</button>\n          </div>\n          <div class="thumbnail-grid" id="thumbnailGrid"></div>\n        </div>\n\n        <div class="cache-status" id="cacheStatus"></div>\n        <div class="offline-message" id="offlineMessage"></div>\n        <div class="install-prompt" id="installPrompt">\n          <div class="install-content">\n            <div class="install-icon">üì±</div>\n            <div class="install-text">\n              <h3>Add to Home Screen</h3>\n              <p>Get quick access to your catalog</p>\n            </div>\n            <button class="btn-install" id="btnInstall">Install</button>\n            <button class="btn-dismiss" id="btnDismiss">‚úï</button>\n          </div>\n        </div>\n      </div>\n    ',this.attachEventListeners(),this.setupStyles(),this.checkOfflineStatus()}setupStyles(){const n=document.createElement("style");n.textContent="\n      .flipbook-viewer {\n        display: flex;\n        flex-direction: column;\n        height: 100vh;\n        background: #1a1a1a;\n        color: #fff;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n\n      .flipbook-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 12px 16px;\n        background: #0d0d0d;\n        border-bottom: 1px solid #333;\n        gap: 12px;\n        z-index: 100;\n      }\n\n      .flipbook-title {\n        flex: 1;\n        font-size: 18px;\n        font-weight: 600;\n        text-align: center;\n        white-space: nowrap;\n        overflow: hidden;\n        text-overflow: ellipsis;\n        margin: 0;\n      }\n\n      .btn-menu, .btn-download, .btn-close-sidebar, .btn-zoom {\n        background: #333;\n        border: none;\n        color: #fff;\n        padding: 8px 12px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 16px;\n        transition: background 0.2s;\n      }\n\n      .btn-menu:hover, .btn-download:hover, .btn-close-sidebar:hover, .btn-zoom:hover {\n        background: #555;\n      }\n\n      .flipbook-content {\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        position: relative;\n      }\n\n      .zoom-controls {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 8px;\n        padding: 8px;\n        background: #0d0d0d;\n        border-bottom: 1px solid #333;\n      }\n\n      .zoom-level {\n        font-size: 12px;\n        min-width: 50px;\n        text-align: center;\n      }\n\n      .page-container {\n        flex: 1;\n        overflow: auto;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: #0d0d0d;\n        position: relative;\n      }\n\n      .page-viewer {\n        position: relative;\n        display: inline-flex;\n        align-items: center;\n        justify-content: center;\n        cursor: grab;\n        user-select: none;\n        transform-origin: center;\n        will-change: transform;\n        backface-visibility: hidden;\n        -webkit-backface-visibility: hidden;\n      }\n\n      .page-viewer.panning {\n        cursor: grabbing;\n      }\n\n      .page-image {\n        max-width: 100%;\n        max-height: 100%;\n        display: block;\n        image-rendering: high-quality;\n        will-change: transform;\n        backface-visibility: hidden;\n        -webkit-backface-visibility: hidden;\n      }\n\n      .page-controls {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 16px;\n        padding: 12px;\n        background: #0d0d0d;\n        border-top: 1px solid #333;\n      }\n\n      .btn-prev, .btn-next {\n        background: #333;\n        border: none;\n        color: #fff;\n        padding: 8px 16px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 14px;\n        transition: background 0.2s;\n      }\n\n      .btn-prev:hover, .btn-next:hover {\n        background: #555;\n      }\n\n      .btn-prev:disabled, .btn-next:disabled {\n        opacity: 0.5;\n        cursor: not-allowed;\n      }\n\n      .page-counter {\n        font-size: 12px;\n        min-width: 100px;\n        text-align: center;\n      }\n\n      .flipbook-sidebar {\n        position: fixed;\n        left: -320px;\n        top: 0;\n        width: 300px;\n        height: 100vh;\n        background: #1a1a1a;\n        border-right: 1px solid #333;\n        transition: left 0.3s ease-out;\n        z-index: 200;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .flipbook-sidebar.open {\n        left: 0;\n      }\n\n      .sidebar-header {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        padding: 12px;\n        border-bottom: 1px solid #333;\n      }\n\n      .sidebar-header h2 {\n        font-size: 16px;\n        margin: 0;\n      }\n\n      .thumbnail-grid {\n        flex: 1;\n        overflow-y: auto;\n        padding: 8px;\n        display: grid;\n        grid-template-columns: 1fr;\n        gap: 8px;\n      }\n\n      .thumbnail {\n        width: 100%;\n        aspect-ratio: 2/3;\n        background: #0d0d0d;\n        border: 2px solid #333;\n        border-radius: 4px;\n        cursor: pointer;\n        overflow: hidden;\n        transition: border-color 0.2s;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .thumbnail:hover {\n        border-color: #666;\n      }\n\n      .thumbnail.active {\n        border-color: #4caf50;\n      }\n\n      .thumbnail img {\n        width: 100%;\n        height: 100%;\n        object-fit: contain;\n        background: #0d0d0d;\n      }\n\n      .cache-status {\n        position: fixed;\n        bottom: 20px;\n        left: 20px;\n        background: #333;\n        padding: 12px 16px;\n        border-radius: 4px;\n        font-size: 12px;\n        max-width: 200px;\n        z-index: 500;\n        display: none;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n      }\n\n      .cache-status.show {\n        display: block;\n        animation: slideIn 0.3s ease-out;\n      }\n\n      .cache-status.success {\n        background: #4caf50;\n        color: #fff;\n      }\n\n      .cache-status.error {\n        background: #f44336;\n        color: #fff;\n      }\n\n      .cache-status.info {\n        background: #2196f3;\n        color: #fff;\n      }\n\n      .offline-message {\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: #f44336;\n        color: #fff;\n        padding: 24px 32px;\n        border-radius: 8px;\n        text-align: center;\n        z-index: 600;\n        display: none;\n        max-width: 80%;\n        box-shadow: 0 4px 16px rgba(0,0,0,0.4);\n      }\n\n      .offline-message.show {\n        display: block;\n        animation: fadeIn 0.3s ease-out;\n      }\n\n      @keyframes slideIn {\n        from {\n          transform: translateX(-20px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n\n      @keyframes fadeIn {\n        from {\n          opacity: 0;\n        }\n        to {\n          opacity: 1;\n        }\n      }\n\n      .install-prompt {\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        background: #333;\n        border: 2px solid #4caf50;\n        border-radius: 8px;\n        padding: 16px;\n        z-index: 400;\n        display: none;\n        max-width: 300px;\n        box-shadow: 0 4px 16px rgba(0,0,0,0.4);\n      }\n\n      .install-prompt.show {\n        display: flex;\n        animation: slideIn 0.3s ease-out;\n      }\n\n      .install-content {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        width: 100%;\n      }\n\n      .install-icon {\n        font-size: 32px;\n        flex-shrink: 0;\n      }\n\n      .install-text {\n        flex: 1;\n      }\n\n      .install-text h3 {\n        margin: 0;\n        font-size: 14px;\n        font-weight: 600;\n        color: #fff;\n      }\n\n      .install-text p {\n        margin: 4px 0 0 0;\n        font-size: 12px;\n        color: #ccc;\n      }\n\n      .btn-install {\n        background: #4caf50;\n        border: none;\n        color: #fff;\n        padding: 6px 12px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 12px;\n        font-weight: 600;\n        flex-shrink: 0;\n        transition: background 0.2s;\n      }\n\n      .btn-install:hover {\n        background: #45a049;\n      }\n\n      .btn-dismiss {\n        background: transparent;\n        border: none;\n        color: #999;\n        cursor: pointer;\n        font-size: 16px;\n        padding: 0;\n        flex-shrink: 0;\n        transition: color 0.2s;\n      }\n\n      .btn-dismiss:hover {\n        color: #fff;\n      }\n\n      @media (max-width: 768px) {\n        .flipbook-title {\n          font-size: 16px;\n        }\n\n        .page-controls {\n          gap: 8px;\n          padding: 8px;\n        }\n\n        .btn-prev, .btn-next {\n          padding: 6px 12px;\n          font-size: 12px;\n        }\n\n        .zoom-controls {\n          gap: 4px;\n          padding: 4px;\n        }\n\n        .btn-zoom {\n          padding: 6px 8px;\n          font-size: 14px;\n        }\n      }\n    ",document.head.appendChild(n)}attachEventListeners(){const n=document.getElementById("btnMenu"),e=document.getElementById("btnDownload"),i=document.getElementById("btnPrev"),s=document.getElementById("btnNext"),a=document.getElementById("btnCloseSidebar"),o=document.getElementById("pageContainer"),r=document.getElementById("pageViewer"),l=document.getElementById("btnZoomIn"),d=document.getElementById("btnZoomOut"),c=document.getElementById("btnFitWidth");null==n||n.addEventListener("click",()=>this.toggleSidebar()),null==e||e.addEventListener("click",()=>this.downloadForOffline()),null==i||i.addEventListener("click",()=>this.previousPage()),null==s||s.addEventListener("click",()=>this.nextPage()),null==a||a.addEventListener("click",()=>this.toggleSidebar()),null==l||l.addEventListener("click",()=>this.zoomIn()),null==d||d.addEventListener("click",()=>this.zoomOut()),null==c||c.addEventListener("click",()=>this.fitToWidth()),o&&(this.gestureHandler=new t(o),this.gestureHandler.onSwipeLeft=()=>this.nextPage(),this.gestureHandler.onSwipeRight=()=>this.previousPage()),r&&(r.addEventListener("mousedown",n=>this.startPan(n)),r.addEventListener("mousemove",n=>this.doPan(n)),r.addEventListener("mouseup",()=>this.endPan()),r.addEventListener("mouseleave",()=>this.endPan()),r.addEventListener("wheel",n=>this.handleWheel(n),{passive:!1})),this.cacheManager.onStateChange(n=>{this.updateCacheStatus(n)}),window.addEventListener("online",()=>this.checkOfflineStatus()),window.addEventListener("offline",()=>this.checkOfflineStatus());const h=document.getElementById("btnInstall"),p=document.getElementById("btnDismiss");h&&h.addEventListener("click",()=>this.installPWA()),p&&p.addEventListener("click",()=>this.dismissInstallPrompt()),window.addEventListener("beforeinstallprompt",n=>this.handleBeforeInstallPrompt(n))}async loadBook(n){if(!this.isLoading){this.isLoading=!0;try{const e=`${this.baseUrl}books/${n}/manifest.json`,t=await fetch(e);if(!t.ok)throw new Error(`Failed to load manifest: ${t.statusText}`);this.manifest=await t.json(),console.log("Manifest loaded:",this.manifest),this.manifest.pages&&this.manifest.pages.length>0&&console.log("First page object:",this.manifest.pages[0]),this.currentPageIndex=0,this.zoom=1,this.panX=0,this.panY=0,this.renderPage(),this.renderThumbnails(),this.updateDownloadButton()}catch(e){console.error("Error loading book:",e),this.showError(`Failed to load book: ${n}`)}finally{this.isLoading=!1}}}renderPage(){if(!this.manifest)return void console.error("No manifest loaded");const n=this.manifest.pages[this.currentPageIndex];if(console.log("Current page index:",this.currentPageIndex),console.log("Page object:",n),!n)return void console.error("Page not found at index:",this.currentPageIndex);const e=document.getElementById("pageImage"),t=document.getElementById("pageCounter"),i=document.getElementById("bookTitle");document.getElementById("pageViewer"),e.src=`${this.baseUrl}books/${this.manifest.id}/${n.image}`,e.alt=`Page ${n.pageNumber}`,t&&(t.textContent=`Page ${n.pageNumber} of ${this.manifest.totalPages}`),i&&(i.textContent=this.manifest.title),this.zoom=1,this.panX=0,this.panY=0,this.updatePageTransform(),this.updatePageControls(),this.preloadAdjacentPages()}renderThumbnails(){if(!this.manifest)return;const n=document.getElementById("thumbnailGrid");n&&(n.innerHTML="",this.manifest.pages.forEach((e,t)=>{const i=document.createElement("div");i.className="thumbnail",t===this.currentPageIndex&&i.classList.add("active");const s=document.createElement("img");s.src=`${this.baseUrl}books/${this.manifest.id}/${e.thumbnail}`,s.alt=`Thumbnail page ${e.pageNumber}`,s.loading="lazy",i.appendChild(s),i.addEventListener("click",()=>{this.currentPageIndex=t,this.renderPage(),this.renderThumbnails()}),n.appendChild(i)}))}preloadAdjacentPages(){if(this.manifest){if(this.currentPageIndex>0){const n=this.manifest.pages[this.currentPageIndex-1];(new Image).src=`${this.baseUrl}books/${this.manifest.id}/${n.image}`}if(this.currentPageIndex<this.manifest.pages.length-1){const n=this.manifest.pages[this.currentPageIndex+1];(new Image).src=`${this.baseUrl}books/${this.manifest.id}/${n.image}`}}}updatePageControls(){var n;const e=document.getElementById("btnPrev"),t=document.getElementById("btnNext");e&&(e.disabled=0===this.currentPageIndex),t&&(t.disabled=this.currentPageIndex===((null==(n=this.manifest)?void 0:n.pages.length)??1)-1)}nextPage(){this.manifest&&this.currentPageIndex<this.manifest.pages.length-1&&(this.currentPageIndex++,this.renderPage(),this.renderThumbnails())}previousPage(){this.currentPageIndex>0&&(this.currentPageIndex--,this.renderPage(),this.renderThumbnails())}toggleSidebar(){const n=document.getElementById("sidebar");null==n||n.classList.toggle("open")}zoomIn(){this.zoom=Math.min(this.zoom+.2,this.maxZoom),this.updatePageTransform()}zoomOut(){this.zoom=Math.max(this.zoom-.2,this.minZoom),this.updatePageTransform()}fitToWidth(){const n=document.getElementById("pageContainer"),e=document.getElementById("pageImage");if(n&&e&&e.naturalWidth){const t=n.clientWidth;this.zoom=t/e.naturalWidth,this.updatePageTransform()}}startPan(n){if(this.zoom<=1)return;this.isPanning=!0,this.panStartX=n.clientX-this.panX,this.panStartY=n.clientY-this.panY;const e=document.getElementById("pageViewer");null==e||e.classList.add("panning")}doPan(n){!this.isPanning||this.zoom<=1||(this.panX=n.clientX-this.panStartX,this.panY=n.clientY-this.panStartY,null!==this.panAnimationId&&cancelAnimationFrame(this.panAnimationId),this.panAnimationId=requestAnimationFrame(()=>{this.updatePageTransform(),this.panAnimationId=null}))}endPan(){this.isPanning=!1;const n=document.getElementById("pageViewer");null==n||n.classList.remove("panning")}handleWheel(n){if(!n.ctrlKey&&!n.metaKey)return;n.preventDefault();const e=this.zoom;n.deltaY<0?this.zoom=Math.min(this.zoom+.1,this.maxZoom):this.zoom=Math.max(this.zoom-.1,this.minZoom),this.zoom!==e&&this.updatePageTransform()}updatePageTransform(){const n=document.getElementById("pageViewer"),e=document.getElementById("zoomLevel");if(n){const e=this.panX/this.zoom,t=this.panY/this.zoom;n.style.transform=`translate3d(${e}px, ${t}px, 0) scale(${this.zoom})`}e&&(e.textContent=`${Math.round(100*this.zoom)}%`)}async downloadForOffline(){if(!this.manifest)return;const n=document.getElementById("btnDownload");n&&(n.disabled=!0),this.showCacheStatus("Downloading‚Ä¶","info");try{await this.cacheManager.cacheBook(this.manifest),this.showCacheStatus("Offline Ready ‚úì","success"),n&&(n.textContent="‚úì")}catch(e){console.error("Failed to cache book:",e),this.showCacheStatus("Download failed","error")}}showCacheStatus(n,e){const t=document.getElementById("cacheStatus");t&&(t.textContent=n,t.className=`cache-status show ${e}`,"success"!==e&&"error"!==e||setTimeout(()=>{t.classList.remove("show")},3e3))}async checkOfflineStatus(){if(!navigator.onLine&&this.manifest){await this.cacheManager.isBookCached(this.manifest.id)||this.showOfflineMessage("Offline assets not downloaded yet. Please connect once.")}}showOfflineMessage(n){const e=document.getElementById("offlineMessage");e&&(e.textContent=n,e.classList.add("show"),setTimeout(()=>{e.classList.remove("show")},5e3))}updateCacheStatus(n){}showError(n){const e=document.getElementById("offlineMessage");e&&(e.textContent=n,e.classList.add("show"))}async updateDownloadButton(){if(!this.manifest)return;const n=document.getElementById("btnDownload");if(n)try{await this.cacheManager.isBookCached(this.manifest.id)?(n.textContent="‚úì",n.disabled=!0,n.title="Book is cached for offline"):(n.textContent="‚¨á",n.disabled=!1,n.title="Download for Offline")}catch(e){console.error("Error updating download button:",e)}}handleBeforeInstallPrompt(n){n.preventDefault(),this.deferredPrompt=n;const e=document.getElementById("installPrompt");e&&e.classList.add("show")}async installPWA(){if(!this.deferredPrompt)return;this.deferredPrompt.prompt();const{outcome:n}=await this.deferredPrompt.userChoice;console.log(`User response: ${n}`),this.deferredPrompt=null,this.dismissInstallPrompt()}dismissInstallPrompt(){const n=document.getElementById("installPrompt");n&&n.classList.remove("show")}}("app","/HighPowerCatalog/"),a=new URLSearchParams(window.location.search).get("book")||"catalog_11-12-25";s.loadBook(a).catch(n=>{console.error("Failed to load book:",n)});
